
* * *

🎯 命令队列与命令列表的设计理念
=================

> 📅 更新时间：2023年3月8日

* * *

🧠 背景目标
-------

为了实现以下两大目标，Direct3D 12 对提交渲染工作的方式进行了根本性的变革：

1. **渲染工作的复用能力（Re-use）**
    
2. **多线程扩展能力（Multi-threaded scaling）**
    

这导致与旧版本相比，Direct3D 12 在渲染提交过程上有三个显著变化：

* * *

🔄 与旧版本的三大关键区别
--------------

1. **移除了立即上下文（Immediate Context）** → 实现多线程能力
    
2. **应用负责将渲染调用组织为 GPU 工作项** → 实现复用
    
3. **应用显式控制 GPU 提交时机** → 同时支撑前两项能力
    

* * *

🚫 移除立即上下文（Immediate Context）
-----------------------------

Direct3D 12 相比 D3D11 最大的改变就是：**不再有与设备绑定的唯一立即上下文（Immediate Context）**。

### ✅ 取而代之的机制：

* 应用通过**创建命令列表（Command Lists）**来进行渲染。
    
* 命令列表中调用传统的渲染 API，类似于 D3D11 中 `Render()` 函数的内容。
    
* **每个命令列表**本身仍是**非线程安全的（不能并发记录）**，但：
    
    * 可以**同时并发记录多个命令列表** → 利用多核处理器
        

### ♻️ 命令列表的重用

* 命令列表**通常只执行一次**；
    
* 也**可以重复执行**，前提是应用确保前一次执行已完成；
    
* 同步控制请参考：[执行与同步命令列表](#)。
    

* * *

📦 组织 GPU 工作项
-------------

除了普通命令列表，Direct3D 12 还引入了第二层级的命令列表：**Bundles（捆绑列表）**。

### 🧾 两种命令列表的区别：

| 类型 | 说明 |
| --- | --- |
| **Direct Command List（直接命令列表）** | 一般意义上的命令列表，用于实际提交至 GPU 执行 |
| **Bundle（捆绑列表）** | 将一小组 API 调用封装起来，供 Direct 命令列表调用 |

### 🔁 Bundle 的用途

* 在创建 Bundle 时，驱动会进行尽可能多的**预处理**，提升后续执行效率；
    
* Bundle 可在**多个命令列表中重复执行**，也可**在同一命令列表中多次调用**；
    
* 这使得单线程情况下也能获得极高的效率；
    
* Bundle **有一定限制**（不能执行所有操作）；
    
    * 详见：[创建与记录命令列表与 Bundle](#)。
        

* * *

🚀 提交 GPU 工作
------------

要让 GPU 执行渲染任务，应用程序必须将命令列表**显式提交**到与设备关联的 **命令队列（Command Queue）**。

### 🧷 提交细节

* **Direct Command List**
    
    * 可重复提交；
        
    * 应用需确保：**前一次 GPU 执行已完成**再重新提交。
        
* **Bundle**
    
    * **无并发使用限制**；
        
    * 可在多个命令列表中重复使用；
        
    * 但 **不能直接提交给命令队列**，只能嵌套在 Direct Command List 中。
        

### 🧵 多线程提交

* **任何线程**都可以**随时将命令列表提交**到任意命令队列；
    
* Direct3D Runtime 会**自动序列化**这些提交操作，同时**保持提交顺序**。
    

* * *

📚 相关主题
-------

* [创建与记录命令列表与 Bundle](#)
    
* [执行与同步命令列表](#)
    
* [命令队列、Fence 与 GPU 同步机制详解](#)
    

* * *